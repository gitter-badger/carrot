<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>network.js - Documentation</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Connection.html">Connection</a></li><li><a href="Group.html">Group</a></li><li><a href="Layer.html">Layer</a><ul class='members'><li data-type='member'><a href="Layer.html#.activate">activate</a></li><li data-type='member'><a href="Layer.html#.next">next</a></li><li data-type='member'><a href="Layer.html#.previous">previous</a></li><li data-type='member'><a href="Layer.html#.propagate">propagate</a></li><li data-type='member'><a href="Layer.html#.weights">weights</a></li></ul><ul class='methods'><li data-type='method'><a href="Layer.html#connected">connected</a></li><li data-type='method'><a href="Layer.html#neurons">neurons</a></li><li data-type='method'><a href="Layer.html#project">project</a></li><li data-type='method'><a href="Layer.html#reset">reset</a></li></ul></li><li></li><li><a href="Neuron.html">Neuron</a><ul class='methods'><li data-type='method'><a href="Neuron.html#clear">clear</a></li><li data-type='method'><a href="Neuron.html#connected">connected</a></li><li data-type='method'><a href="Neuron.html#reset">reset</a></li><li data-type='method'><a href="Neuron.html#selfconnected">selfconnected</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="Layer_Layer_can.html">can</a><ul class='methods'><li data-type='method'><a href="Layer_Layer_can.html#.activate">activate</a></li><li data-type='method'><a href="Layer_Layer_can.html#.propagate">propagate</a></li></ul></li><li><a href="Layer_Layer_has.html">has</a><ul class='methods'><li data-type='method'><a href="Layer_Layer_has.html#.activated">activated</a></li><li data-type='method'><a href="Layer_Layer_has.html#.propagated">propagated</a></li></ul></li><li><a href="Layer_Layer_is.html">is</a><ul class='methods'><li data-type='method'><a href="Layer_Layer_is.html#.input">input</a></li><li data-type='method'><a href="Layer_Layer_is.html#.output">output</a></li></ul></li><li><a href="Neuron.squash.html">squash</a><ul class='methods'><li data-type='method'><a href="Neuron.squash.html#.HLIM">HLIM</a></li><li data-type='method'><a href="Neuron.squash.html#.IDENTITY">IDENTITY</a></li><li data-type='method'><a href="Neuron.squash.html#.LOGISTIC">LOGISTIC</a></li><li data-type='method'><a href="Neuron.squash.html#.RELU">RELU</a></li><li data-type='method'><a href="Neuron.squash.html#.TANH">TANH</a></li></ul></li><li><a href="Neuron_Neuron_is.html">is</a><ul class='methods'><li data-type='method'><a href="Neuron_Neuron_is.html#.connected">connected</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#_trainSet">_trainSet</a></li><li><a href="global.html#activate">activate</a></li><li><a href="global.html#inputs">inputs</a></li><li><a href="global.html#LayerConnection">LayerConnection</a></li><li><a href="global.html#neurons">neurons</a></li><li><a href="global.html#outputs">outputs</a></li><li><a href="global.html#Perceptron">Perceptron</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#restore">restore</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#train">train</a></li><li><a href="global.html#XOR">XOR</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">network.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>let _ = require('lodash')
let Neuron = require('./neuron');
let Layer = require('./layer');
let Trainer = require('./trainer');

let Network = function({
  input = null,
  hidden = [],
  output = null
} = {}) {
  this.layers = { input, hidden, output };
  this.optimized = null;
  
  /** 
  * Feed-activate activate the network
  *
  * @param {number[]} input
  * @returns {number[]}
  */
  this.activate = function(input) {
    if(this.optimized === false) {
      this.layers.input.activate(input);
      _.each(this.layers.hidden, function(layer) { layer.activate() })
      return this.layers.output.activate();
    }
    else {
      if(this.optimized == null) this.optimize();
      return this.optimized.activate(input);
    }
  }
  
  /**
  * Returns all the neurons in the network
  *
  * @returns {Neuron[]}
  */
  this.neurons = function() {
    let neurons = [];

    _.each(this.layers.input.neurons(), function(neuron) {
      neurons.push({ neuron, layer: 'input' })
    })
    
    _.each(this.layers.hidden, function(layer, index) {
      _.each(layer.neurons(), function(neuron) {
        neurons.push({ neuron, layer: index });
      })
    })
    
    _.each(this.layers.output.neurons(), function(neuron) {
      neurons.push({ neuron, layer: 'output' })
    })

    return neurons;
  }

  /**
  * Returns number of inputs of the network
  *
  * @returns {number}
  */
  this.inputs = function() {
    return this.layers.input.size;
  }

  /**
  * Returns number of outputs of hte network
  *
  * @returns {number}
  */
  this.outputs = function() {
    return this.layers.output.size;
  }

  /**
  * Sets the layers of the network
  */
  this.set = function({
    input = null,
    hidden = [],
    output = null
  } = {}) {
    this.layers = { input, hidden, output };
    if(this.optimized) this.optimized.reset();
  }

  /**
  * Restores network values (de-optimizes) - done to edit network
  */
  this.restore = function() {
    if(!this.optimized) return;

    let optimized = this.optimized;

    let getValue = function () {
      let args = Array.prototype.slice.call(arguments);

      let unit = args.shift();
      let prop = args.pop();

      let id = prop + '_';
      for(let property in args) id += args[property] + '_';
      id += unit.ID;

      let memory = optimized.memory;
      let variables = optimized.data.variables;

      if(id in variables) return memory[variables[id].id];
      return 0;
    }

    let list = this.neurons();

    // link id's to positions in the array
    _.each(list, function(neuron) {
      while(neuron.neuron) neuron = neuron.neuron;

      neuron.state = getValue(neuron, 'state');
      neuron.old = getValue(neuron, 'old');
      neuron.activation = getValue(neuron, 'activation');
      neuron.bias = getValue(neuron, 'bias');

      for (let input in neuron.trace.elegibility)
        neuron.trace.elegibility[input] = getValue(neuron, 'trace', 'elegibility', input);

      for (let gated in neuron.trace.extended)
        for (let input in neuron.trace.extended[gated])
          neuron.trace.extended[gated][input] = getValue(neuron, 'trace', 'extended', gated, input);

      // get connections
      _.each(neuron.connections.projected, function(connection) {
        connection.weight = getValue(connection, 'weight');
        connection.gain = getValue(connection, 'gain');
      })
    })
  }
  
  /**
  * Reset all weights and clear all traces
  */
  this.reset = function() {
    this.restore();

    this.layers.input.reset();
    _.each(this.layers.hidden, function(layer) { layer.reset(); })
    this.layers.output.reset();

    if(this.optimized) this.optimized.reset();
  }
}

module.exports = Network</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Mar 18 2019 21:10:13 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/jquery-3.1.1.min.js"></script>

<script src="scripts/search.js"></script>




</body>
</html>
